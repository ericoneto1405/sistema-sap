{% extends 'base.html' %}

{% block title %}Coletas{% endblock %}

{% block content %}
<div class="page-header">
    <h2>üì¶ Coletas</h2>
    <div class="filtros">
        <a href="{{ url_for('coletas.index', filtro='pendentes') }}" 
           class="btn-filtro {% if filtro == 'pendentes' %}ativo{% endif %}">
            üìã Pendentes
        </a>
        <a href="{{ url_for('coletas.index', filtro='coletados') }}" 
           class="btn-filtro {% if filtro == 'coletados' %}ativo{% endif %}">
            ‚úÖ Coletados
        </a>
        <a href="{{ url_for('coletas.index', filtro='todos') }}" 
           class="btn-filtro {% if filtro == 'todos' %}ativo{% endif %}">
            üëÅÔ∏è Todos
        </a>
    </div>
</div>

<style>
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid #e9ecef;
    }

    .page-header h2 {
        color: #2c3e50;
        margin: 0;
        font-size: 1.8rem;
    }

    .filtros {
        display: flex;
        gap: 10px;
    }

    .btn-filtro {
        padding: 8px 16px;
        border: 2px solid #ddd;
        border-radius: 8px;
        text-decoration: none;
        color: #666;
        font-weight: 500;
        transition: all 0.2s ease;
        background: white;
    }

    .btn-filtro:hover {
        border-color: #007bff;
        color: #007bff;
        transform: translateY(-1px);
    }

    .btn-filtro.ativo {
        background: #007bff;
        border-color: #007bff;
        color: white;
    }

    .tabela-coletas {
        width: 100%;
        border-collapse: collapse;
        background: #fff;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 30px;
    }

    .tabela-coletas th {
        background: #2c3e50;
        color: white;
        padding: 15px 12px;
        font-weight: 600;
        text-align: left;
        font-size: 0.9rem;
    }

    .tabela-coletas td {
        padding: 12px;
        border-bottom: 1px solid #f1f3f4;
        vertical-align: middle;
    }

    .tabela-coletas tr:hover {
        background: #f8f9fa;
    }

    .tabela-coletas tr:last-child td {
        border-bottom: none;
    }

    .status-badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 500;
        text-align: center;
        min-width: 80px;
        display: inline-block;
    }

    .status-pendente {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
    }

    .status-coletado {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }

    .status-parcial {
        background: #cce5ff;
        color: #004085;
        border: 1px solid #99d6ff;
    }

    .acoes {
        display: flex;
        gap: 8px;
        align-items: center;
    }

    .btn-acao {
        padding: 6px 12px;
        border: none;
        border-radius: 6px;
        text-decoration: none;
        font-size: 0.85rem;
        font-weight: 500;
        transition: all 0.2s ease;
        cursor: pointer;
    }

    .btn-coletar {
        background: #28a745;
        color: white;
    }

    .btn-coletar:hover {
        background: #218838;
        transform: translateY(-1px);
    }

    .btn-ver {
        background: #6c757d;
        color: white;
    }

    .btn-ver:hover {
        background: #5a6268;
        transform: translateY(-1px);
    }

    .btn-historico {
        background: #17a2b8;
        color: white;
    }

    .btn-historico:hover {
        background: #138496;
        transform: translateY(-1px);
    }

    .vazio {
        text-align: center;
        padding: 60px 20px;
        color: #6c757d;
    }

    .vazio i {
        font-size: 3rem;
        margin-bottom: 15px;
        color: #dee2e6;
    }

    .vazio h3 {
        margin-bottom: 10px;
        color: #495057;
    }

    .vazio p {
        margin: 0;
        font-size: 0.95rem;
    }

    .info-cliente {
        font-weight: 500;
        color: #2c3e50;
    }

    .info-data {
        color: #6c757d;
        font-size: 0.9rem;
    }

    .info-valor {
        font-weight: 600;
        color: #28a745;
    }

    .info-itens {
        color: #6c757d;
        font-size: 0.85rem;
    }
</style>

{% if pedidos %}
    <table class="tabela-coletas">
        <thead>
            <tr>
                <th>Pedido</th>
                <th>Cliente</th>
                <th>Data</th>
                <th>Status</th>
                <th>Itens</th>
                <th>Valor</th>
                <th>A√ß√µes</th>
            </tr>
        </thead>
        <tbody>
            {% for item in pedidos %}
                <tr>
                    <td>
                        <strong>#{{ item.pedido.id }}</strong>
                    </td>
                    <td>
                        <div class="info-cliente">{{ item.pedido.cliente.nome }}</div>
                    </td>
                    <td>
                        <div class="info-data">{{ item.pedido.data.strftime('%d/%m/%Y') }}</div>
                    </td>
                    <td>
                        {% if item.pedido.status.value == 'Pagamento Aprovado' %}
                            <span class="status-badge status-pendente">üìã Pendente</span>
                        {% elif item.pedido.status.value == 'Coleta Parcial' %}
                            <span class="status-badge status-parcial">üîÑ Parcial</span>
                        {% elif item.pedido.status.value == 'Coleta Conclu√≠da' %}
                            <span class="status-badge status-coletado">‚úÖ Coletado</span>
                        {% else %}
                            <span class="status-badge">{{ item.pedido.status.value }}</span>
                        {% endif %}
                    </td>
                    <td>
                        <div class="info-itens">
                            {{ item.itens_coletados }}/{{ item.total_itens }} itens
                        </div>
                    </td>
                    <td>
                        <div class="info-valor">R$ {{ "%.2f"|format(item.total_venda) }}</div>
                    </td>
                    <td>
                        <div class="acoes">
                            <a href="{{ url_for('coletas.detalhes_pedido', pedido_id=item.pedido.id) }}" 
                               class="btn-acao btn-ver" title="Ver detalhes">
                                üëÅÔ∏è Ver
                            </a>
                            {% if not item.coletado_completo %}
                                <a href="{{ url_for('coletas.processar_coleta', pedido_id=item.pedido.id) }}" 
                                   class="btn-acao btn-coletar" title="Processar coleta">
                                    üì¶ Coletar
                                </a>
                            {% endif %}
                            {% if item.itens_coletados > 0 %}
                                <a href="{{ url_for('coletas.historico_coletas', pedido_id=item.pedido.id) }}" 
                                   class="btn-acao btn-historico" title="Ver hist√≥rico">
                                    üìã Hist√≥rico
                                </a>
                            {% endif %}
                        </div>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <div class="vazio">
        <i class="fas fa-inbox"></i>
        <h3>
            {% if filtro == 'coletados' %}
                Nenhum pedido coletado
            {% elif filtro == 'pendentes' %}
                Nenhum pedido pendente
            {% else %}
                Nenhum pedido encontrado
            {% endif %}
        </h3>
        <p>
            {% if filtro == 'pendentes' %}
                Todos os pedidos j√° foram coletados ou n√£o h√° pedidos com pagamento aprovado.
            {% else %}
                N√£o h√° dados para exibir com o filtro selecionado.
            {% endif %}
        </p>
    </div>
{% endif %}

{% endblock %}
