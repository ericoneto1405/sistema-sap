{% extends 'base.html' %}

{% block title %}{% if produto %}Editar Produto{% else %}Novo Produto{% endif %}{% endblock %}

{% block page_title %}{% if produto %}Editar Produto{% else %}Novo Produto{% endif %}{% endblock %}

{% block content %}
<div class="card" style="max-width: 600px; margin: 0 auto;">
    <h2>{% if produto %}‚úèÔ∏è Editar Produto{% else %}‚ûï Novo Produto{% endif %}</h2>
    
    <form method="POST" id="formProduto">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        
        <div class="form-group">
            <label for="nome">Nome *</label>
            <input type="text" 
                   id="nome" 
                   name="nome" 
                   value="{{ produto.nome if produto else '' }}" 
                   required 
                   class="form-control">
        </div>

        <div class="form-group">
            <label for="categoria">Categoria *</label>
            <select id="categoria" name="categoria" required class="form-control">
                <option value="">Selecione uma categoria</option>
                <option value="CERVEJA" {% if produto and produto.categoria == 'CERVEJA' %}selected{% endif %}>CERVEJA</option>
                <option value="NAB" {% if produto and produto.categoria == 'NAB' %}selected{% endif %}>NAB</option>
                <option value="OUTROS" {% if produto and produto.categoria == 'OUTROS' %}selected{% endif %}>OUTROS</option>
            </select>
        </div>

        <div class="form-group">
            <label for="codigo_interno">C√≥digo Interno</label>
            <input type="text" 
                   id="codigo_interno" 
                   name="codigo_interno" 
                   value="{{ produto.codigo_interno if produto else '' }}"
                   class="form-control">
        </div>

        <div class="form-group">
            <label for="ean">EAN/C√≥digo de Barras</label>
            <input type="text" 
                   id="ean" 
                   name="ean" 
                   value="{{ produto.ean if produto else '' }}"
                   class="form-control"
                   placeholder="Ex: 7891234567890">
        </div>

        <div class="d-flex gap-2 justify-content-between mt-4">
            <a href="{{ url_for('produtos.listar_produtos') }}" class="btn btn-secondary">‚¨Ö Voltar</a>
            <button type="submit" class="btn btn-success" id="btnSalvar">
                üíæ Salvar Produto
            </button>
        </div>
    </form>
</div>

<script nonce="{{ nonce }}">
// Prevenir double-submit
document.getElementById('formProduto').addEventListener('submit', function(e) {
    const btnSalvar = document.getElementById('btnSalvar');
    if (btnSalvar.disabled) {
        e.preventDefault();
        return false;
    }
    
    // Desabilitar bot√£o ap√≥s submit
    btnSalvar.disabled = true;
    btnSalvar.innerHTML = '‚è≥ Salvando...';
    
    // Re-habilitar ap√≥s 3 segundos (caso haja erro e p√°gina n√£o redirecione)
    setTimeout(function() {
        btnSalvar.disabled = false;
        btnSalvar.innerHTML = 'üíæ Salvar Produto';
    }, 3000);
});
</script>
{% endblock %}
